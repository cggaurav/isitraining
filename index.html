<!DOCTYPE html>
<html>
<head>
	<title>Is it raining where you are?</title>
	<link rel="shortcut icon" type="image/ico" href="./favicon.ico"/>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	<style> 
		body {
			font-family: "Helvetica";
			font-size: 30px;
			margin: 50px;
			text-align: center;
		}


		h1 {
			text-align: center;
			margin-top: 80px;
			font-size: 30px;
			font-weight: 300;
		}

		h2 {
			color: red;
			text-align: center;
			margin-top: 40px;
			font-size: 25px;
			font-weight: 300;
		}
	</style>
</head>
<body>

	<h1> Is it <strong> Raining ? </strong> </h1>

	<h2 id="notify"> Seems like we won"t be able to help you! </h2>


</body>
	<script>

		function bootstrap() {
			document.getElementById("notify").style.visibility = "hidden"
		}

		bootstrap()

		if ("geolocation" in navigator) {

			var options = {
				// enableHighAccuracy: true,
				timeout: 5000,
				maximumAge: 0
			};

			function success(pos) {
				var coordinates = pos.coords

				console.log('Your current position is:')
				console.log(`Latitude : ${coordinates.latitude}`)
				console.log(`Longitude: ${coordinates.longitude}`)
				console.log(`More or less ${coordinates.accuracy} meters.`)

				let URL = ["http://api.wunderground.com/auto/wui/geo/WXCurrentObXML/index.xml?query=", [coordinates.latitude, coordinates.longitude].join(',')].join('')

				$.ajax({
				    url: url,
				    type: "GET",
				    crossDomain: true,
				    contentType: "text/xml",
				    headers: {
						"accept": "application/xml",
						"Access-Control-Allow-Origin":"*"
				    },
				    // dataType: "text",
				    success : (data) => {
				    	console.log('data', data)
				    },
				    error : (xhr, ajaxOptions, thrownError) => {
				    	console.error(xhr.status)        
				    	console.error(thrownError)

				    	document.getElementById("notify").style.visibility = "visible"
				    } 
				})
			}

			function error(err) {
			  	console.warn(`ERROR(${err.code}): ${err.message}`)
			}

			$(document).ready(() => {
				// console.log("Lets go")
				setTimeout(() => {
					navigator.geolocation.getCurrentPosition(success, error, options)
				}, 100)
			})


		} else {
		 	document.getElementById("notify").style.visibility = "visible"
		}

	</script>
</html>
